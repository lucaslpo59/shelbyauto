<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RuinerAuto</title>
    <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<style>

.h1, .h2, .h3, .h4, .h5, .h6, h1, h2, h3, h4, h5, h6 {
    margin-bottom: .5rem;
    font-family: inherit;
    font-weight: 500;
    line-height: 1.2;
    color: #0c0c0c;
}
</style>

</head>

<body>
    <header class="">
        <nav class="navbar navbar-expand-lg">
            <div class="container">
                <img src="https://i.ibb.co/QyrTP0y/A-c-pia.png"
                    alt="Logo Concession√°ria GTA RP" style="height: 50px;">
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                    aria-controls="navbarResponsive" aria-expanded="false" aria-label="Alternar navega√ß√£o">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="homepage.html">HOMEPAGE</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="filter.html">NOSSO ESTOQUE</a>
                        </li>
                    </ul>
                </div>

                <!-- Menu do Usu√°rio -->
                <div class="user-menu" id="userMenu">
                    <div class="user-profile" onclick="toggleMenu()" style="display: none;">
                        <img src="https://i.pravatar.cc/50" id="userAvatar" alt="Avatar">
                        <span id="userName">Usu√°rio</span>
                    </div>
                    <div class="dropdown-menu" id="dropdownMenu">
                        <ul>
                            <li><a href="profile.html"><i class="fa-solid fa-user"></i> Meu Perfil</a></li>
                            <li><a href="settings.html"><i class="fa-solid fa-cog"></i> Configura√ß√µes</a></li>
                            <li><a href="#" id="logout"><i class="fa-solid fa-sign-out-alt"></i> Sair</a></li>
                        </ul>
                    </div>
                </div>

                <!-- Link para login/registro -->
                <div id="loginRegister" style="display: none;">
                    <a href="index.html">Fazer Login / Registrar</a>
                </div>
            </div>
        </nav>
    </header>


    <div class="container products">

        <!-- Esta linha estava duplicada, ent√£o removi -->
        <div class="products-container" id="car-list"></div>

    </div> <!-- Fechamento correto da "container products" -->

    <!-- O script que gera os carros deve estar FORA da div principal -->
    <script>
        const carros = [
            {
                nome: "GOL G4 RALLY",
                preco: "R$ 15.750,00",
                fipe: "R$ 21.00,00",
                km: "000.410 KM",
                cambio: "Manual",
                placa: "XJR-0532",

                vendido: false,  // false, üî¥ Carro foi vendido
                imagens: ["https://media.discordapp.net/attachments/1343384117135282267/1343384133883269191/image.png?ex=67bdbc38&is=67bc6ab8&hm=45ea2a6236eed5c47d086042daaf6f884939aa5617516848acdd59174e8bdafb&=&format=webp&quality=lossless",
                    "https://media.discordapp.net/attachments/1343384117135282267/1343384214871085057/image.png?ex=67bdbc4b&is=67bc6acb&hm=acdb7ddafe68ffbe56a33e19b2e06334f7e3418d850f7d8f796d702423a71dd7&=&format=webp&quality=lossless",
                    "https://media.discordapp.net/attachments/1343384117135282267/1343384363525472256/image.png?ex=67bdbc6f&is=67bc6aef&hm=e4af10ea6a8cbfc3a8c1d76e95268d7eb76eb979fa41806049a7e9d1acefebbd&=&format=webp&quality=lossless"
                ],
                specs: [
                    "<strong>Pist√£o:</strong> Original",
                    "<strong>Biela:</strong> Original",
                    "<strong>Cabe√ßote:</strong> Original",
                    "<strong>Comando:</strong> Original",
                    "<strong>Radiador:</strong> Original",
                    "<strong>Nitro:</strong> <span style='color:red;'>N√£o</span>",
                    "<strong>Turbo:</strong> <span style='color:red;'>N√£o</span>",
                    "<strong>Radiador de √ìleo:</strong> <span style='color:red;'>N√£o</span>",
                    "<strong>Intercooler:</strong> <span style='color:red;'>N√£o</span>",
                    "<strong>C√¢mbio:</strong> Original",
                    "<strong>Suspens√£o:</strong> Original",
                    "<strong>Freios:</strong> Original",
                    "<strong>Coletor ESC:</strong> Original",
                    "<strong>Coletor ADM:</strong> Original",
                    "<strong>Moral:</strong> <span style='color:green;'>0/200</span>"
                ],
                documentation: {
                    roda: "Original",
                    turbo: "N√£o",
                    cor: "Preto",
                    legalizado: true
                }
            },
        ];

        carros.forEach((carro, index) => {
            document.write(`
        <div class="product-item">
            <div class="product-content">
                <div class="carousel" id="carousel-${index}">
                    <button class="carousel-prev" onclick="prevImage(${index})">&#10094;</button>
                    <div class="carousel-images">
                        ${carro.imagens.map((img, i) => `<img src="${img}" class="${i === 0 ? 'active' : ''}" alt="${carro.nome}">`).join('')}
                    </div>
                    <button class="carousel-next" onclick="nextImage(${index})">&#10095;</button>
                </div>
                <div class="product-info">
                    <hr>
                    <h4>${carro.nome}</h4><h6>${carro.preco}</h6>
                    <p class="${carro.vendido ? 'legalizado' : 'nao-legalizado'}">
                        ${carro.vendido ? 'DISPONIVEL' : 'N√ÉO DISPONIVEL'}
                    </p>
                    <hr>
                    <p>FIPE: ${carro.fipe}</p>
                    <p>${carro.km} | ${carro.placa} | ${carro.cambio}</p>
                    
                    <button class="form-btn" data-index="${index}">FAZER UMA PROPOSTA</button>
                </div>
                <div class="specifications">
                    <h5>Especifica√ß√µes</h5>
                    <ul>
                        ${carro.specs.map(spec => `<li>${spec}</li>`).join('')}
                    </ul>
                </div>
                <div class="documentation">
                    <h5>Documenta√ß√£o</h5>
                    <p><strong>Roda:</strong> ${carro.documentation.roda}</p>
                    <p><strong>Turbo:</strong> ${carro.documentation.turbo}</p>
                    <p><strong>Cor:</strong> ${carro.documentation.cor}</p>
                    <p class="${carro.documentation.legalizado ? 'legalizado' : 'nao-legalizado'}">
                        ${carro.documentation.legalizado ? 'Legalizado' : 'N√£o Legalizado'}
                    </p>
                </div>
<div class="form-popup" id="form-${index}">
    <h2>FAZER UMA PROPOSTA</h2>
    <input type="hidden" id="carroImagem-${index}">
<input type="hidden" id="carroNome-${index}" name="carroNome">
<input type="hidden" id="carroPreco-${index}" name="carroPreco">
<input type="hidden" id="carroFipe-${index}" name="carroFipe">
<input type="hidden" id="carroKm-${index}" name="carroKm">
<input type="hidden" id="carroCambio-${index}" name="carroCambio">
<input type="hidden" id="carroPlaca-${index}" name="carroPlaca">


    <input type="text" id="nome-${index}" class="popup-input" placeholder="Nome In-Game">
    <input type="text" id="discord-${index}" class="popup-input" placeholder="Discord">
    <input type="text" id="celular-${index}" class="popup-input" placeholder="Celular In-Game">
    <textarea id="comentario-${index}" class="popup-textarea" placeholder="Escreva aqui a sua proposta..."></textarea>
    
<div class="upload-container">
    <label for="fotoCarro-${index}" class="upload-label">
        üì∏ Enviar Foto do Ve√≠culo:
    </label>
    <input type="file" id="fotoCarro-${index}" class="upload-input" accept="image/*">
    <span id="file-name-${index}" class="file-name">Nenhum arquivo escolhido</span>
</div>

    <div class="popup-btn-container">
        <button class="popup-btn submit" onclick="enviarFormulario(${index})">Enviar</button>
        <button class="popup-btn close" onclick="closeForm(${index})">Fechar</button>
    </div>
</div>


            </div>
        </div>
    `);
        });
    </script>
    </div>
    </div>
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="inner-content">
                        <p2>COPYRIGHT ¬© 2025 SHELBY AUTO ( BRASILIA RP ) SERVER 2 - DESENVOLVIDO BY <a href="#">Shelby
                                Enterprises L.L.C</a></p2>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.querySelectorAll(".upload-input").forEach(input => {
    input.addEventListener("change", function () {
        let fileName = this.files.length > 0 ? this.files[0].name : "Nenhum arquivo escolhido";
        document.getElementById(`file-name-${this.id.split("-")[1]}`).textContent = fileName;
    });
});

        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll(".form-btn").forEach(button => {
                button.addEventListener("click", function () {
                    let index = this.getAttribute("data-index");
                    openForm(index);
                });
            });

            // üîπ Esconde todos os formul√°rios no carregamento
            document.querySelectorAll(".form-popup").forEach(form => {
                form.style.display = "none";
            });
        });

        function openForm(index) {
    let form = document.getElementById(`form-${index}`);

    if (!form) {
        console.error(`‚ùå Erro: Formul√°rio form-${index} n√£o encontrado.`);
        return;
    }

    form.style.display = "flex";
    setTimeout(() => {
        form.classList.add("show"); // üîπ Adiciona a anima√ß√£o ao abrir
    }, 10);

    let productItem = document.querySelectorAll(".product-item")[index];

    if (!productItem) {
        console.error("‚ùå Erro: O elemento .product-item n√£o foi encontrado.");
        return;
    }

    let carRect = productItem.getBoundingClientRect();
    form.style.left = `${carRect.right + 15}px`;
    form.style.top = `${carRect.top}px`;

    // üîπ Pegando informa√ß√µes completas do carro
    if (carros[index]) {
        let carro = carros[index];

        // üõë Atualiza os campos ocultos no formul√°rio
        document.getElementById(`carroNome-${index}`).value = carro.nome;
        document.getElementById(`carroPreco-${index}`).value = carro.preco;
        document.getElementById(`carroFipe-${index}`).value = carro.fipe;
        document.getElementById(`carroKm-${index}`).value = carro.km;
        document.getElementById(`carroCambio-${index}`).value = carro.cambio;
        document.getElementById(`carroPlaca-${index}`).value = carro.placa;
        let campoImagem = document.getElementById(`carroImagem-${index}`);
if (campoImagem) {
    campoImagem.value = carro.imagem || "";
}
    } else {
        console.warn(`‚ö†Ô∏è Nenhum carro encontrado no √≠ndice ${index}`);
    }

    // üîπ Adicionando evento ao bot√£o de envio do formul√°rio
    let submitButton = form.querySelector(".popup-btn.submit");
    if (submitButton) {
        submitButton.onclick = function () {
            enviarFormulario(index);
        };
    }
}

// üîπ Fun√ß√£o para converter imagem em Base64
function converterImagemBase64(file) {
    return new Promise((resolve, reject) => {
        let reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });
}

// üîπ Fun√ß√£o para fechar o formul√°rio e limpar os campos
function closeForm(index) {
    let form = document.getElementById(`form-${index}`);
    if (form) {
        form.classList.remove("show"); // üîπ Remove anima√ß√£o de abertura
        setTimeout(() => {
            form.style.display = "none";
        }, 300);

        // üîπ Limpa os campos do formul√°rio, incluindo inputs e textarea
        form.querySelectorAll("input, textarea").forEach(input => {
            if (input.type !== "hidden") { // Mant√©m os campos ocultos com informa√ß√µes do carro
                input.value = "";
            }
        });
    }
}

        // üîπ Fun√ß√£o para enviar o formul√°rio
        function enviarFormulario(index) {
            let form = document.getElementById(`form-${index}`);

            if (!form) {
                console.error(`‚ùå Erro: Formul√°rio form-${index} n√£o encontrado.`);
                return;
            }

            // üîπ Simula envio de formul√°rio (aqui voc√™ pode adicionar requisi√ß√£o para backend ou Discord Webhook)
            console.log("‚úÖ Formul√°rio enviado com sucesso!");

            // üîπ Fecha e limpa o formul√°rio ap√≥s o envio
            closeForm(index);
        }


        // Estilos CSS corrigidos
        document.head.insertAdjacentHTML("beforeend", `
<style>

/* üîπ Melhorando a posi√ß√£o do formul√°rio */


/* üîπ Esconde o formul√°rio ao carregar a p√°gina */
.form-popup {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: absolute;
    left: 105%; /* Mant√©m o formul√°rio ao lado do carro */
    margin-left: -110px;
    margin-top: -170px;
background: linear-gradient(269deg, #efeded, #efeded);
    width: 400px;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.3);
    text-align: center;
    animation: fadeIn 0.3s ease-in-out;
    border: 2px solid #ddd;
    opacity: 0; /* üîπ Inicia invis√≠vel */
    transform: scale(0.9); /* üîπ Efeito de zoom */
    transition: all 0.3s ease-in-out;
}

/* üîπ Quando for exibido, faz a anima√ß√£o */
.form-popup.show {
    display: flex;
    opacity: 1;
    transform: scale(1);
}

/* üîπ Mant√©m o t√≠tulo azul gradiente */
.form-popup h2 {
               background: linear-gradient(269deg, #efeded, #efeded);
    color: #000000;
    font-size: 18px;
    padding: 15px;
    border-radius: 10px 10px 0 0;
    margin: -25px -25px 20px -25px;
    text-align: center;
    width: calc(100% + 50px);
}

/* üîπ Inputs */
.popup-input {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 14px;
}

/* üîπ Bot√µes lado a lado */
.popup-btn-container {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    margin-top: 15px;
}

/* üîπ Caixa de Coment√°rio Opcional */
.popup-textarea {
    width: 100%;
    height: 100px;
    padding: 12px;
    margin: 8px 0;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 14px;
    resize: none;
}

/* üîπ Bot√£o Enviar */
.popup-btn.submit {
    flex: 1;
    background: #ffffff;
    color: #141313;
    padding: 12px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    font-size: 16px;
    transition: all 0.3s ease-in-out;
    width: 170px;
}

.popup-btn.submit:hover {
    background: #138496;
}

/* üîπ Bot√£o Fechar */
.popup-btn.close {
    flex: 1;
    background: #000000c7;
    color: white;
    padding: 12px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    font-size: 16px;
    width: 170px;
}


`);

    </script>

    <script>

function enviarFormulario(index) {
    let nomeCarro = document.getElementById(`carroNome-${index}`).value;
    let carroPreco = document.getElementById(`carroPreco-${index}`).value;
    let carroFipe = document.getElementById(`carroFipe-${index}`).value;
    let carroKm = document.getElementById(`carroKm-${index}`).value;
    let carroCambio = document.getElementById(`carroCambio-${index}`).value;
    let carroPlaca = document.getElementById(`carroPlaca-${index}`).value;
    let nome = document.getElementById(`nome-${index}`).value;
    let discord = document.getElementById(`discord-${index}`).value;
    let celular = document.getElementById(`celular-${index}`).value;
    let comentario = document.getElementById(`comentario-${index}`).value || "Nenhum coment√°rio";
    let fotoInput = document.getElementById(`fotoCarro-${index}`);
    let foto = fotoInput && fotoInput.files.length > 0 ? fotoInput.files[0] : null;

    if (!nome || !discord || !celular) {
        alert("Por favor, preencha todos os campos obrigat√≥rios.");
        return;
    }

    function enviarParaDiscord(fotoURL = null) {
        let mensagem = {
            username: "Novo Formul√°rio",
            avatar_url: "https://img.freepik.com/psd-gratuitas/icone-do-whatsapp-isolado-ilustracao-de-renderizacao-3d_47987-9785.jpg",
            content: `üì© **SAQ > ( Entrar Em Contato )**\n\n
### üîπ **Informa√ß√µes do Ve√≠culo:**\n
üöó **Carro:** \`${nomeCarro}\`\n
üí∞ **Pre√ßo:** \`${carroPreco}\`\n
üìä **FIPE:** \`${carroFipe}\`\n
üõ£Ô∏è **KM:** \`${carroKm}\`\n
‚öô **C√¢mbio:** \`${carroCambio}\`\n
üî¢ **Placa:** \`${carroPlaca}\`\n

### üîπ **Dados do Interessado:**\n
üë§ **Nome:** \`${nome}\`\n
üéß **Discord:** \`${discord}\`\n
üì± **Celular In-Game:** \`${celular}\`\n
üí¨ **Coment√°rio:** \`${comentario}\`\n
${fotoURL ? `üñºÔ∏è **Foto do Ve√≠culo:** [Clique para ver](${fotoURL})\n` : ""}
`
        };

        fetch("https://discordapp.com/api/webhooks/1343741774644117534/zoYLMvqda0hJRJNjDtBzE_3DNN9-EY651LjHIdpNSCygGjHE-Xjxln0uxjBSIbq8RiiZ", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(mensagem)
        }).then(response => {
            if (response.ok) {
                alert("‚úÖ Formul√°rio enviado com sucesso!");
                closeForm(index); // Fecha o formul√°rio ap√≥s envio
            } else {
                alert("‚ùå Erro ao enviar formul√°rio.");
            }
        }).catch(error => {
            alert("‚ùå Erro de conex√£o: " + error.message);
        });
    }

    // üîπ Se houver imagem, faz upload antes de enviar
    if (foto) {
        let formData = new FormData();
        formData.append("image", foto);

        fetch("https://api.imgbb.com/1/upload?key=a85bd55edbbb971f0b7d546e0830327b", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                enviarParaDiscord(data.data.url); // Envia para o Discord com o link da imagem
            } else {
                console.error("Erro ao enviar imagem.");
                enviarParaDiscord(null); // Envia sem imagem
            }
        })
        .catch(error => {
            console.error("Erro ao enviar imagem:", error);
            enviarParaDiscord(null); // Envia sem imagem
        });
    } else {
        enviarParaDiscord(null); // Se n√£o houver imagem, apenas envia o formul√°rio
    }
}
</script>


<script>
    function toggleMenu() {
        let menu = document.getElementById("dropdownMenu");
        menu.style.display = (menu.style.display === "block") ? "none" : "block";
    }

    // Fecha o menu se o usu√°rio clicar fora dele
    document.addEventListener("click", function (event) {
        let menu = document.getElementById("dropdownMenu");
        let profile = document.querySelector(".user-profile");

        if (!profile.contains(event.target) && !menu.contains(event.target)) {
            menu.style.display = "none";
        }
    });

    // Simulando um usu√°rio logado (pode vir de API, LocalStorage ou Backend)
    document.addEventListener("DOMContentLoaded", function () {
        let user = {
            name: "Lucas",
            avatar: "https://i.pravatar.cc/50" // Substitua pela URL do avatar real
        };

        // Atualiza os dados do usu√°rio
        document.getElementById("userName").textContent = user.name;
        document.getElementById("userAvatar").src = user.avatar;
    });
</script>

    <!-- üîπ Importando o Firebase e Script Global -->
    <script type="module" src="assets/js/auth.js"></script>

    <!-- üîπ Script para abrir/fechar o menu do usu√°rio -->
    <script>
        function toggleMenu() {
            let menu = document.getElementById("dropdownMenu");
            menu.style.display = (menu.style.display === "block") ? "none" : "block";
        }

        // Fecha o menu se o usu√°rio clicar fora dele
        document.addEventListener("click", function (event) {
            let menu = document.getElementById("dropdownMenu");
            let profile = document.querySelector(".user-profile");

            if (!profile.contains(event.target) && !menu.contains(event.target)) {
                menu.style.display = "none";
            }
        });
    </script>
</body>

</html>